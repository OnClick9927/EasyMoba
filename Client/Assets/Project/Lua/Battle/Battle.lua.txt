BattlePlayMode = {
    Normal = 1,
    Local = 2,
    Recorder = 4,
}

---@type ModeServer
local mode_server
local room_id
local role_id
---@type FrameHandler
local frame_handler


Battle = {}
Battle.ScenePart = require("Battle.Scene.ScenePart")
Battle.players = nil


---@param battle_mode any
---@param room string
---@param players number[]
function Battle.StartGame(battle_mode, room, players)
    Battle.players = players
    room_id = room
    role_id = Models.PlayerModel:GetRoleID()
    CS.BattleModePlayer.LocalInputRecorder.Instance.roleid = role_id
    CS.BattleModePlayer.LocalInputRecorder.Instance.roomid = room_id
    mode_server = CS.BattleModePlayer.Create(battle_mode)
    frame_handler = require("Battle.FrameHandler")()
    Battle.ScenePart.LoadScene()
end

function Battle.CloseGame()
    mode_server:Dispose()
    frame_handler = nil
end

---@param data SPBattleFrame
function Battle.OnBattelFrame(data)
    frame_handler:OnBattelFrame(data)
end

function Battle.SendFrame(frame_id)
    CS.BattleModePlayer.LocalInputRecorder.Instance.roleid = role_id
    CS.BattleModePlayer.LocalInputRecorder.Instance.roomid = room_id
    CS.BattleModePlayer.LocalInputRecorder.Instance.curframe = frame_id
    mode_server:SendFrameToServer()
end