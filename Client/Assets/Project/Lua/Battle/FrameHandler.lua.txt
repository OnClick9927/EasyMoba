---@class FrameHandler
local M = class("FrameHandler")
local player = require("Battle.FramePlayer")


function M:ctor()
    self.curFrame = 0
    ---@type table<number,SPBattleFrame>
    self.frames = {}
end

---@param data SPBattleFrame
function M:OnBattelFrame(data)
    local frame = data.frameID
    if frame >= self.curFrame then
        self.frames[frame] = data
    end
    while self.frames[self.curFrame] do
        self:PlayFrame(self.frames[self.curFrame])
        self.curFrame = self.curFrame + 1
    end
end

---@param data SPBattleFrame
function M:PlayFrame(data)
    for index, value in ipairs(data.datas) do
        local role = value.roleID
        local op = value.opText
        ---@type BattleOp
        local op_tab = Json.decode(op)
        player.PlayFrame(role, op_tab)
    end
end

return M
